from machine import UART, Pin, I2C, Timer, ADC
from ssd1306 import SSD1306_I2C
import time

import framebuf


img1 = bytearray( [
    #// font edit begin : monovlsb : 40 : 40 : 40
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x80, 0x80, 0x80, 0x80, 0x40, 0x40, 0x40, 
    0x20, 0x20, 0x60, 0x80, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0xCE, 0x3F, 0x0F, 0x06, 0x04, 0x04, 0x02, 0x02, 
    0x01, 0x01, 0x00, 0x04, 0x04, 0x0E, 0x0E, 0x3E, 
    0xFE, 0x0C, 0x00, 0x00, 0x03, 0xFC, 0xC0, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x38, 0x78, 
    0x7F, 0x60, 0x40, 0x4E, 0x47, 0x83, 0x80, 0x90, 
    0x90, 0x81, 0x87, 0x8F, 0x4E, 0x60, 0x60, 0x60, 
    0x73, 0x7C, 0x78, 0x78, 0x7C, 0x1F, 0x0F, 0x0E, 
    0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    #// font edit end
    ])

img2 = bytearray( [
    #// font edit begin : monovlsb : 40 : 40 : 40
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x80, 0x40, 0x40, 0x80, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0xFC, 0x3E, 0x0E, 0x0C, 0x08, 0x04, 0x02, 0x02, 
    0x02, 0x02, 0x01, 0x09, 0x09, 0x09, 0x0D, 0x3D, 
    0xFD, 0x19, 0x01, 0x00, 0x00, 0x00, 0x0F, 0x30, 
    0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 
    0x7F, 0x60, 0x40, 0x5C, 0x8E, 0x82, 0x80, 0xA0, 
    0xA0, 0x82, 0x86, 0x9E, 0x9C, 0x40, 0x40, 0xE0, 
    0xF3, 0xFC, 0xF8, 0xF8, 0xE8, 0xC8, 0xCC, 0x0E, 
    0x0F, 0x0E, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    #// font edit end
    ])

image1 = framebuf.FrameBuffer(img1, 40, 40, framebuf.MONO_VLSB)
image2 = framebuf.FrameBuffer(img2, 40, 40, framebuf.MONO_VLSB)
top1 = 30
top2 = 32
images = [(image1, top1), (image2, top2)]

def loading(oled, msg='Loading...', duration=5, interval=0.2):
    oled.fill(0)
    left = 85
    steps = 5
    while duration >0:
        if left < 0:
            left = 85
        for image, top in images:
            oled._msg(msg)
            oled.blit(image, left, top)
            oled.show()
            time.sleep(interval)
            oled.fill(0)
            duration -= interval
            left -= steps

if __name__ == '__main__':
    i2c = I2C(1, scl=Pin(15), sda=Pin(14), freq= 400000)
    oled_width = 128
    oled_height = 64
    oled = SSD1306_I2C(oled_width, oled_height, i2c)
    oled._msg = oled.text
    loading(oled, msg='Hello', duration=100)